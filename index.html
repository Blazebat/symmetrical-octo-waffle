<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RageTV CRT</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
  <div class="crt-tv">
    <!-- Top bezel -->
    <div class="bezel top"></div>

    <!-- Screen -->
    <div class="screen-container">
      <video id="tvPlayer"></video>
      <button id="startBtn" class="start-btn">â–¶ï¸ Start TV</button>
    </div>

    <!-- Bottom bezel with speaker grills -->
    <div class="bezel bottom">
      <div class="speakers left"></div>
      <div class="speakers right"></div>
      <div class="buttons">
        <button id="prevChannel">â®ï¸</button>
        <button id="nextChannel">â­ï¸</button>
        <button id="volDown">ğŸ”‰</button>
        <button id="volUp">ğŸ”Š</button>
      </div>
    </div>

    <!-- TV brand logo under CRT -->
    <img src="ragetv.png" alt="RageTV Logo" class="tv-logo">

    <!-- Overlay for channel and volume -->
    <div class="overlay" id="overlay">
      <div id="overlayChannel">Channel 1</div>
      <div id="overlayVolume">Volume: 50%</div>
    </div>
  </div>

<script>
let channels = [];
let currentIndex = 0;
const tvPlayer = document.getElementById('tvPlayer');
const overlay = document.getElementById('overlay');
const overlayChannel = document.getElementById('overlayChannel');
const overlayVolume = document.getElementById('overlayVolume');
const startBtn = document.getElementById('startBtn');

// Load channels
fetch('channels.json')
  .then(res => res.json())
  .then(data => {
    channels = data;
    if (channels.length > 0) overlayChannel.textContent = channels[0].name;
  });

function showOverlay() {
  overlay.style.opacity = 1;
  clearTimeout(overlay.timeout);
  overlay.timeout = setTimeout(() => overlay.style.opacity = 0, 2000);
}

function loadChannel(index) {
  if (!channels.length) return;
  currentIndex = index;
  const url = channels[index].url;
  overlayChannel.textContent = channels[index].name;
  showOverlay();

  if (Hls.isSupported()) {
    if (window.hls) window.hls.destroy();
    const hls = new Hls();
    window.hls = hls;
    hls.loadSource(url);
    hls.attachMedia(tvPlayer);
    hls.on(Hls.Events.MANIFEST_PARSED, function() {
      tvPlayer.play().catch(() => console.log("User must start playback"));
    });
  } else if (tvPlayer.canPlayType('application/vnd.apple.mpegurl')) {
    tvPlayer.src = url;
  } else {
    alert("HLS not supported in this browser");
  }
}

function nextChannel() { currentIndex = (currentIndex + 1) % channels.length; loadChannel(currentIndex); }
function prevChannel() { currentIndex = (currentIndex - 1 + channels.length) % channels.length; loadChannel(currentIndex); }
function volUp() { tvPlayer.volume = Math.min(tvPlayer.volume + 0.1, 1); overlayVolume.textContent = `Volume: ${Math.round(tvPlayer.volume*100)}%`; showOverlay(); }
function volDown() { tvPlayer.volume = Math.max(tvPlayer.volume - 0.1, 0); overlayVolume.textContent = `Volume: ${Math.round(tvPlayer.volume*100)}%`; showOverlay(); }

document.getElementById('nextChannel').onclick = nextChannel;
document.getElementById('prevChannel').onclick = prevChannel;
document.getElementById('volUp').onclick = volUp;
document.getElementById('volDown').onclick = volDown;

document.addEventListener('keydown', (e) => {
  switch(e.key) {
    case 'ArrowUp': volUp(); break;
    case 'ArrowDown': volDown(); break;
    case 'ArrowRight': nextChannel(); break;
    case 'ArrowLeft': prevChannel(); break;
    case 'Enter':
      if(tvPlayer.paused) tvPlayer.play();
      else tvPlayer.pause();
      showOverlay();
      break;
  }
});

startBtn.addEventListener('click', () => {
  startBtn.style.display = 'none';
  if (channels.length > 0) loadChannel(0);
});
</script>
</body>
</html>
